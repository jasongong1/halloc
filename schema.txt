CREATE TABLE users (
        zid INTEGER NOT NULL,
        email TEXT NOT NULL,
        username TEXT,
        hash TEXT NOT NULL,
        PRIMARY KEY(zid),
        UNIQUE(email)
    );

CREATE TABLE rooms (
        id INTEGER NOT NULL,
        room_name TEXT NOT NULL,
        room_type TEXT,
        college_id INT NOT NULL,
        floor_id INT NOT NULL,
        PRIMARY KEY(id),
        FOREIGN KEY(college_id) REFERENCES colleges(id),
        FOREIGN KEY(floor_id) REFERENCES floors(id)
    );

CREATE TABLE floors (
        id INTEGER NOT NULL,
        floor_level TEXT,
        college_id INT NOT NULL,
        PRIMARY KEY(id),
        FOREIGN KEY(college_id) REFERENCES colleges(id)
    );

CREATE TABLE colleges (
        id INTEGER NOT NULL,
        college_name TEXT NOT NULL,
        PRIMARY KEY(id)
    );

CREATE TABLE preferences (
        id INTEGER NOT NULL,
        user_zid INT NOT NULL,
        room_id INT NOT NULL,
        rank INT NOT NULL,
        PRIMARY KEY(id),
        FOREIGN KEY(user_zid) REFERENCES users(zid),
        FOREIGN KEY(room_id) REFERENCES rooms(id)
    );

CREATE TRIGGER preferences__increment_rank_before_insertion
BEFORE INSERT ON preferences
FOR EACH ROW
BEGIN
    UPDATE preferences
    SET rank = rank + 1
    WHERE user_zid = NEW.user_zid
    AND rank >= NEW.rank;
END;

CREATE TRIGGER preferences__decrement_rank_after_deletion
AFTER DELETE ON preferences
FOR EACH ROW
BEGIN
    UPDATE preferences
    SET rank = rank - 1
    WHERE user_zid = OLD.user_zid
    AND rank > OLD.rank;
END;

==================== for testing, init a small db
